$(document).ready(function(){$("a").on("click",function(e){if(""!==this.hash){e.preventDefault();var t=this.hash;$("html, body").animate({scrollTop:$(t).offset().top},800,function(){window.location.hash=t})}})});var numVertices,w=window.innerWidth;h=window.innerHeight,radius=5.7,links=[],simulate=!0,zoomToAdd=!0,color=d3.scale.quantize().domain([1e4,7250]).range(["#000","#2aff00","#183900","#000","#000"]),numVertices=h<w?w*h/(17e3*h/w):w*h*9/4e4;var vertices=d3.range(numVertices).map(function(e){return angle=radius*(e+10),{x:angle*Math.cos(angle)+w/2,y:angle*Math.sin(angle)+h/2}}),d3_geom_voronoi=d3.geom.voronoi().x(function(e){return e.x}).y(function(e){return e.y}),prevEventScale=1,zoom=d3.behavior.drag().on("drag",function(e,t){force.nodes(vertices).start()});d3.select(window).on("keydown",function(){16==d3.event.keyCode&&(zoomToAdd=!1),83==d3.event.keyCode&&(simulate=!simulate,simulate?force.start():force.stop())}).on("keyup",function(){zoomToAdd=!0});var svg=d3.select("#chart").append("svg").attr("width",w).attr("height",h).call(zoom),force=d3.layout.force().charge((h,-300)).size([w*(w>h?.32:0),h*(w>h?1:.9)]).on("tick",update);force.nodes(vertices).start();var circle=svg.selectAll("circle"),path=svg.selectAll("path"),link=svg.selectAll("line");function update(e){(path=path.data(d3_geom_voronoi(vertices))).enter().append("path").call(d3.behavior.drag().on("drag",function(e,t){vertices[t]={x:vertices[t].x+d3.event.dx,y:vertices[t].y+d3.event.dy}})).on("mouseover",function(){console.log("hey"),d3.event.scale>prevEventScale?(angle=radius*vertices.length,vertices.pop()):2<vertices.length&&d3.event.scale!=prevEventScale&&vertices.pop(),force.nodes(vertices).start(),prevEventScale=d3.event.scale}).style("fill",function(e,t){return color(0)}),path.attr("d",function(e){return"M"+e.join("L")+"Z"}).transition().duration(150).style("fill",function(e,t){return color(d3.geom.polygon(e).area())}),path.exit().remove(),(circle=circle.data(vertices)).enter().append("circle").attr("r",0).transition().duration(1e3).attr("r",5),circle.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),circle.exit().transition().attr("r",0).remove(),(link=link.data(d3_geom_voronoi.links(vertices))).enter().append("line"),link.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),link.exit().remove(),simulate||force.stop()}setInterval(function(){force.start()},2500);